/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/model/json/JSONModel","sap/fin/travel/lib/reuse/util/i18n","sap/fin/travel/lib/reuse/util/FragmentHelper","sap/fin/travel/lib/reuse/util/Utils","sap/m/MessageToast","sap/ui/core/ValueState","sap/ui/core/MessageType","sap/m/MessageStrip"],function(J,I,F,U,M,V,a,b){"use strict";var s="SubmitDisclaimerDialogFragment";function _(m,C){var o=m.getMetaModel();var t=o.getODataEntityType("TRV_MTE_SRV.TravelExpense");var r=o.getODataProperty(t,"Reason");var R=o.getObject("com.sap.vocabularies.Common.v1.Label/String",r);var e=R||r["sap:label"];var g=new J({Reason:C.getProperty("Reason"),ReasonProperty:r});return{facadeModel:g,label:e};}function v(i,C){var B=i.getBinding("value");var e=false;try{if(i.getVisible()){B.getType().validateValue(i.getValue());}}catch(E){e=true;i.setValueState(V.Error);}return e;}function S(e,C){if(C.oSubmitDisclaimerFragment){sap.ui.core.Fragment.byId(s,"SubmitCheckbox").setSelected(false);sap.ui.core.Fragment.byId(s,"SubmitButton").setEnabled(false);C.oSubmitDisclaimerFragment.unbindElement();C.oSubmitDisclaimerFragment.close();}}function f(e,C){var g=function(){S(e,C);};var h=function(){S(e,C);M.show(I.get().getText(C,"SUBMIT_ERROR_MSG"),{duration:2000,onClose:C._eventHandler.onShowMessages});};var r=sap.ui.core.Fragment.byId(s,"SumbitInputReasonID");if(!v(r,C)){if(!U.isEmptyObjectOrString(r.getValue())){var m=C.getView().getModel();var o=C.oSubmitDisclaimerFragment.getModel("facadeModel");m.setProperty("Reason",o.getProperty("/Reason"),C.getView().getBindingContext());}C._eventHandler.handleSubmitAction(e,g,h,h);}}function c(e,C){sap.ui.core.Fragment.byId(s,"SubmitButton").setEnabled(e.getParameter("selected"));}function d(e,C){var A=function(){sap.ui.core.Fragment.byId(s,"CancelButton").attachPress(C,S);sap.ui.core.Fragment.byId(s,"SubmitButton").attachPress(C,f);sap.ui.core.Fragment.byId(s,"SubmitCheckbox").attachSelect(C,c);C.oSubmitDisclaimerFragment.setModel(C.getView().getModel());var m=C.getView().getModel().getMetaModel();var t=m.getODataEntityType("TRV_MTE_SRV.TravelExpense");var r=m.getODataProperty(t,"Reason");var R=new sap.m.Input({id:s+"--SumbitInputReasonID",type:"Text",value:{path:"facadeModel>/Reason",type:"sap.ui.model.type.String",constraints:{minLength:1,maxLength:r.maxLength}},visible:"{= ${ReasonFc} > 0 }"});var g=sap.ui.core.Fragment.byId(s,"SimpleFormReasonID");g.addContent(R);sap.ui.getCore().getMessageManager().registerObject(R,true);R.attachLiveChange(function(D){if(!U.isEmptyObjectOrString(D.getParameter("value"))){R.setValueState(V.None);R.setValueStateText("");}});};var o=function(){var r=_(C.getView().getModel(),C.getView().getBindingContext());C.oSubmitDisclaimerFragment.setModel(r.facadeModel,"facadeModel");var m=e.getErrors();C.oSubmitDisclaimerFragment.bindElement(e.getSource().getBindingContext().getPath());C.oSubmitDisclaimerFragment.setModel(new J({stripMessage:m&&m.length>0?m[0].message:"",stripType:m&&m.length>0?a.Warning:a.None,submitText:e.getSource().getBindingContext().getObject().SubmitText.length>0?e.getSource().getBindingContext().getObject().SubmitText:I.get().getText(C,"EXPENSE_SUBMIT_DISCLAIMER"),reasonLabel:U.isEmptyObjectOrString(r.label)?I.get().getText(C,"SUBMIT_REASON_LABEL"):r.label}),"submitDisclaimerModel");C.oSubmitDisclaimerFragment.open();};if(F.get().loadFragment&&typeof F.get().loadFragment==="function"){F.get().loadFragment({id:s,name:"fin.travel.mytravelexpensesv2.view.fragments.SubmitDisclaimerDialogWithReason",controller:C,models:{i18n:C.getView().getModel("i18n")}}).then(function(g){if(g){if(!C.oSubmitDisclaimerFragment){C.oSubmitDisclaimerFragment=g;A();}o();}});}else{if(!C.oSubmitDisclaimerFragment){C.oSubmitDisclaimerFragment=F.get().getFragment({id:s,name:"fin.travel.mytravelexpensesv2.view.fragments.SubmitDisclaimerDialogWithReason",controller:C,models:{i18n:C.getView().getModel("i18n")}});A();}o();}}return{viewSubmitDisclaimer:d};});
